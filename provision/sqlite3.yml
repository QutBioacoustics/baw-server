---

# We have to use a statically compiled url download because sqlite is capped to 3.8.4 on Trusty
- name: UNARCHIVE | Download sqlite3 static build
  unarchive:
    src: https://www.sqlite.org/2018/sqlite-autoconf-{{ sqlite_version_download }}.tar.gz
    remote_src: true
    dest: "{{ ansible_user_dir }}"
    mode: a+rx
  become: false
- name: SHELL | Build sqlite
  shell: |
    ./configure
    make
    sudo make install
  args:
    chdir: "{{ ansible_user_dir }}/sqlite-autoconf-{{ sqlite_version_download }}"
- name: SHELL | Check sqlite3 binary
  shell: sqlite3 --version
  changed_when: false
  register: sqlite3_build_results
- name: ASSERT | Assert correct version of sqlite installed
  assert:
    that:
      - sqlite3_build_results.stdout.find(sqlite_version) == 0
