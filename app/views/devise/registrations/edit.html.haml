- content_for :meta_title, "Editing profile for #{resource.user_name}"
- content_for :page_title, 'Profile Settings'
- @info_bar = {title: t('baw.shared.links.profile.title'), icon: 'user'}
- menu_edit_link(:my_profile, edit_user_registration_path, 'profile')

= simple_form_for(resource, as: resource_name, url: registration_path(resource_name), html: { class: 'form-horizontal', method: :put }) do |f|
  = field_set_tag do
    = f.error_notification
    = f.input :user_name, required: true, autofocus: true
    = f.input :email, required: true, placeholder: 'Email'
    = render partial: 'shared/time_zone_select_custom', locals: { f: f, attribute_name: :tzinfo_tz, model_name: resource_name, model: resource }
    - if devise_mapping.confirmable? && resource.pending_reconfirmation?
      %p= t('devise.registrations.edit.currently_waiting_confirmation_for_email', email: resource.unconfirmed_email)
    = f.input :password, autocomplete: 'off', hint: t('devise.registrations.edit.leave_blank_if_you_don_t_want_to_change_it'), required: false
    = f.input :password_confirmation, required: false
    = f.input :current_password, hint: t('devise.registrations.edit.we_need_your_current_password_to_confirm_your_changes'), required: true
    = render partial: 'shared/image_upload', locals: { f: f,  model_instance: resource, model_name: resource_name }
    = f.button :submit_cancel, t('devise.registrations.edit.update'), class: 'btn-default'

%hr/
%h3 Dangerous actions

-# WARNING! LOOK OUT! This MUST be at the top level or be wrapped in a separate form,
-# otherwise other buttons on the form will delete the account!!!
- if Access::Core.is_standard_user?(resource) && !resource.deleted?
  = form_tag(registration_path(resource_name)) do
    %p
      When your account is deactivated:
      %ul
        %li you can no longer log in or make any changes
        %li no other user will be able to see your user name or other user details
        %li your contributions will remain visible and accessible by other users
      If you are sure you want to deactivate your account, click the button below.
      If you ever want to re-activate your account, please
      = link_to 'contact us', :contact_us
      = '.'
    %p
      = button_to t('devise.registrations.edit.cancel_my_account'), registration_path(resource_name),
        data: { confirm: t('devise.registrations.edit.are_you_sure'), toggle: 'tooltip',  placement: 'right' },
        title: t('devise.registrations.edit.cancel_my_account_confirmation'),
        method: :delete, class: 'btn btn-danger'
- elsif resource.deleted?
  %p
    This user has already been archived.
- else
  %p
    Cannot deactivate or delete this user.
