- content_for :title, 'Data Request'

= render partial: 'shared/sidebar_public', locals: {user_show: @user, user_current: current_user}

- if @annotation_download.blank?
  %p Use this form to request annotations or other data related to the audio recordings on this website.
- else
  %h4
    Please select the time zone for the CSV file containing annotations for
    = "#{@annotation_download[:name]}."
  %form.form-inline
    .form-group
      %label{for: 'select_timezone_offset'} Select time zone
      =select_tag(:download_zone_offset, time_zone_options_for_select(@annotation_download[:timezone_name]),
        prompt: 'Select a time zone...', id: 'select_timezone_offset', class: 'form-control')
    %a.btn.btn-default{id: 'download_link', href: @annotation_download[:link]} Download Annotations

  :javascript
    $(document).ready(function() {
      $("#select_timezone_offset").change(function(){
        var selectedTimezoneName = $(this).val();
        if (selectedTimezoneName != '') {
          var dlLinkElement = $('#download_link');
          var newUri = URI(dlLinkElement.attr('href'))
            .removeSearch('selected_timezone_name')
            .addSearch('selected_timezone_name', selectedTimezoneName);
          dlLinkElement.attr('href', newUri);
        }
      });
    });

  %br

  %p
    If you need more data or a different format, please submit a request using this form.

= simple_form_for @data_request, url: '/data_request', html: {class: 'form-horizontal' } do |f|
  = field_set_tag do
    = f.error_notification
    = f.input :name, label: 'Your Name'
    = f.input :email, label: 'Contact Email'
    = f.input :group, label: 'Organisation'
    = f.input :group_type, label: 'Organisation Type', include_blank: false
    = f.input :content, label: 'Request details (include Projects/Sites, dates/times)', as: :text, input_html: {rows: '8',style: 'width:100%'}
    = render partial: 'shared/recaptcha', locals: {data_item: @data_request, data_item_name: 'data_request'}
    = f.button :submit_cancel, 'Submit', class: 'btn-default'

