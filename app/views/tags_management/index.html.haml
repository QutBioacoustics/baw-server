- content_for :title, 'Tag List'

= render partial: 'shared/sidebar_tags_management'

- content_for :right_sidebar do
  = render partial: 'shared/sidebar_metadata_heading', locals: {title: 'Tags', icon_class: 'tags'}

- order_dir_icon = @tags_info[:order_dir] == :asc ? 'caret-down' : 'caret-up'
- order_by_opposite = @tags_info[:order_dir] == :asc ? :desc : :asc
- order_by = @tags_info[:order_by]
- filter = @tags_info[:filter]

.col-sm-12
  .row
    .col-sm-6
      %p= page_entries_info @tags


    .col-sm-6
      = form_tag(tags_management_index_path, method: :get, class: 'form-inline') do
        .form-group
          %label.sr-only{for: 'filter'}
            Filter
          %input.form-control{type: 'search', placeholder: 'Filter', name: 'filter', id: 'filter', value: @tags_info[:filter]}
          %input{type: 'hidden', name: 'order_by', id: 'order_by', value: order_by}
          %input{type: 'hidden', name: 'order_dir', id: 'order_dir', value: @tags_info[:order_dir] }
          = submit_tag('Filter', class: 'btn btn-default')
          = submit_tag('Clear', class: 'btn btn-default')
  .row
    .col-sm-12
      = paginate  @tags

  %table.table.table-striped
    %thead
      %tr
        %th
          = link_to tags_management_index_path order_by: :text, order_dir: order_by_opposite, filter: filter do
            Text
            - if order_by == :text
              %span.fa{class: "fa-#{order_dir_icon}"}
        %th
          = link_to tags_management_index_path order_by: :is_taxanomic, order_dir: order_by_opposite, filter: filter  do
            Taxonomic
            - if order_by == :is_taxanomic
              %span.fa{class: "fa-#{order_dir_icon}"}
        %th
          = link_to tags_management_index_path order_by: :retired, order_dir: order_by_opposite, filter: filter do
            Retired
            - if order_by == :retired
              %span.fa{class: "fa-#{order_dir_icon}"}
        %th
          = link_to tags_management_index_path order_by: :type_of_tag, order_dir: order_by_opposite, filter: filter do
            Type
            - if order_by == :type_of_tag
              %span.fa{class: "fa-#{order_dir_icon}"}
        %th
          = link_to tags_management_index_path order_by: :updated_at, order_dir: order_by_opposite, filter: filter do
            Updated
            - if order_by == :updated_at
              %span.fa{class: "fa-#{order_dir_icon}"}
        %th
          = link_to tags_management_index_path order_by: :updater_id, order_dir: order_by_opposite, filter: filter do
            Updated By
            - if order_by == :updater_id
              %span.fa{class: "fa-#{order_dir_icon}"}
        %th

    %tbody
    - @tags.each do |tag|
      - last_change_at = tag.updated_at.blank? ? tag.created_at : tag.updated_at
      - last_change_id = tag.updater_id.blank? ? tag.creator_id : tag.updater_id
      - user = last_change_id.blank? ? nil : User.find(last_change_id)
      - taggings_count = tag.taggings.count
      %tr
        %td{colspan: 4}
          = link_to tag.text, edit_tags_management_path(tag)
          %br
          - if tag.retired
            %span.label.label-warning{style: 'margin-right: 5px;'}
              %span.fa.fa-archive
              Retired
          - else
            %span.label.label-success{style: 'margin-right: 5px;'}
              %span.fa.fa-flag
              In use
          - if tag.is_taxanomic
            %span.label.label-default{style: 'margin-right: 5px;'}
              %span.fa.fa-book
              Taxonomic
          - else
            %span.label.label-info{style: 'margin-right: 5px;'}
              %span.fa.fa-users
              Folksonomic
          %span.label.label-default{style: 'margin-right: 5px;'}
            %span.fa.fa-info-circle
            = tag.type_of_tag
          %span.label{class: taggings_count > 0 ? 'label-primary' : 'label-default', style: 'margin-right: 5px;'}
            %span.fa.fa-tags
            = taggings_count
        %td= last_change_at.blank? ? '?' : format_sidebar_datetime(last_change_at)
        %td= user.blank? ? '(unknown)' : (link_to(user.user_name, user_account_path(user)))
        %td
          = link_to edit_tags_management_path(user), class: 'btn btn-default btn-xs' do
            %span.fa.fa-edit
            Edit
          = link_to tags_management_path(user), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-default btn-xs' do
            %span.fa.fa-times
            Delete

  - if @tags.empty?
    No tags to show.